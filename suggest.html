<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Contact ‚Äî Matcha in Paris</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Page-only tweaks (kept minimal; layout width remains in styles.css) */
    .center{ text-align:center; }
    .card-xl{ padding:22px; }
    .hint{ color: var(--muted); font-size: 12px; }

    /* Green primary button */
    #sendBtn.btn{ background:#2f5d3a; color:#fff; border-color:#2f5d3a; }
    #sendBtn.btn[disabled]{ opacity:.75; cursor:progress; }

    /* Success card */
    .success-card{
      background:#ffffff;
      border:1px solid var(--border);
      border-radius:12px;
      padding:22px;
      text-align:center;
      box-shadow:0 1px 0 rgba(0,0,0,.04);
    }
    .success-card h3{ margin:0 0 6px; }

    /* Segmented group */
    .seg-group{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 6px; }
    .seg-group input{ display:none; }
    .seg-group label{
      padding:8px 12px; border:1px solid var(--border); border-radius:999px;
      cursor:pointer; user-select:none; background:#fff;
      transition: border-color .2s ease, color .2s ease, background .2s ease;
    }
    .seg-group label.active{ border-color:#2f5d3a; color:#2f5d3a; background:#eef5ef; }

    /* Inputs */
    .form-input, .form-textarea{
      width:100%; padding:10px; border:1px solid var(--border); border-radius:10px;
      background:#fff;
    }
  </style>
</head>
<body>
  <header class="header-bar">
    <nav class="navbar">
      <a id="navAbout" href="index.html">About</a>
      <a id="navSpots" href="spots.html">Spots</a>
      <a id="navContact" class="active" href="suggest.html">Contact</a>
      <button id="langToggle" class="lang-toggle" type="button" aria-label="Toggle language">FR</button>
    </nav>
  </header>

  <!-- Handwritten logo -->
  <div class="logo-hero">
    <img src="assets/logo.png" alt="Matcha in Paris" class="site-logo" width="1099" height="227">
  </div>

  <div class="container">
    <p id="tagline" class="text-muted center">
      Know a spot, found a bug, or want to collaborate? Tell me below ‚òïÔ∏è
    </p>

    <!-- Success state (hidden by default) -->
    <div id="successCard" class="success-card" style="display:none">
      <h3 id="successTitle">Thanks! üíå</h3>
      <p id="successBody">Your message was sent successfully. I‚Äôll review it soon.</p>
      <button id="anotherBtn" class="btn">Submit another</button>
    </div>

    <div id="formCard" class="card card-xl">
      <!-- Submit via fetch to avoid leaving your site -->
      <form id="contactForm" action="https://formspree.io/f/mpwlgdyb" method="POST" novalidate>
        <!-- Topic first -->
        <div>
          <strong id="topicTitle">Topic</strong>
          <div class="seg-group" role="radiogroup" aria-label="Topic">
            <input id="t-spot" type="radio" name="topic" value="submit-spot" checked>
            <label id="lblSpot" for="t-spot">Submit a spot</label>

            <input id="t-bug" type="radio" name="topic" value="bug">
            <label id="lblBug" for="t-bug">Bug / improvement</label>

            <input id="t-collab" type="radio" name="topic" value="collab">
            <label id="lblCollab" for="t-collab">Business collaboration</label>
          </div>
        </div>

        <!-- Email (optional unless business/newsletter) -->
        <label style="display:block;margin-top:10px" for="emailField" id="lblEmail">
          Email <span id="emailHint" class="hint">(optional ‚Äî required for business or newsletter)</span>
        </label>
        <input class="form-input" type="email" name="from_email" id="emailField" placeholder="you@example.com" autocomplete="email">

        <!-- Spot-only fields -->
        <div id="spotFields" style="margin-top:12px">
          <div style="display:flex;gap:12px;flex-wrap:wrap">
            <label style="flex:1 1 260px" for="placeName" id="lblPlace">Place name</label>
            <input class="form-input" name="place_name" id="placeName">

            <label style="flex:1 1 260px" for="placeAddress" id="lblAddress" hidden>Address</label>
            <input class="form-input" name="place_address" id="placeAddress" style="flex:2 1 320px">
          </div>
          <label style="display:block;margin-top:8px" for="gmapUrl" id="lblGmap">
            Google Maps link <span id="gmapHint" class="hint">(optional)</span>
          </label>
          <input id="gmapUrl" class="form-input" name="gmap_url" placeholder="https://maps.google.com/‚Ä¶">
        </div>

        <!-- Message -->
        <label style="display:block;margin-top:12px" for="messageBox" id="lblMessage">Message / details</label>
        <textarea id="messageBox" class="form-textarea" name="message" rows="6" placeholder="Tell me what‚Äôs useful for readers‚Ä¶"></textarea>

        <!-- Newsletter opt-in -->
        <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
          <label id="lblOptin" style="display:flex;align-items:center;gap:6px;font-size:14px;">
            <input type="checkbox" id="newsletterOptin" name="newsletter_optin" value="yes">
            Also subscribe to my weekly tip
          </label>
        </div>

        <!-- Submit -->
        <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
          <button id="sendBtn" class="btn" type="submit">Send</button>
        </div>

        <!-- Formspree metadata -->
        <input type="hidden" name="_subject" value="New message from matchainparis.com">
        <input type="text" name="_gotcha" style="display:none"> <!-- spam honeypot -->
      </form>
    </div>
  </div>

  <footer>¬© <span id="year"></span> matchainparis.com ‚Ä¢ Built with ‚ù§Ô∏è in Paris, by Ellina K-A</footer>

  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // i18n strings
    const I18N_SUGGEST = {
      en: {
        title: "Contact ‚Äî Matcha in Paris",
        nav_about: "About",
        nav_spots: "Spots",
        nav_contact: "Contact",
        toggle_next: "FR",
        tagline: "Know a spot, found a bug, or want to collaborate? Tell me below ‚òïÔ∏è",
        topic: "Topic",
        spot: "Submit a spot",
        bug: "Bug / improvement",
        collab: "Business collaboration",
        email_label: "Email",
        email_hint: "(optional ‚Äî required for business or newsletter)",
        email_ph: "you@example.com",
        place: "Place name",
        address: "Address",
        gmap: "Google Maps link",
        gmap_hint: "(optional)",
        message: "Message / details",
        message_ph: "Tell me what‚Äôs useful for readers‚Ä¶",
        optin: "Also subscribe to my weekly tip",
        send: "Send",
        sending: "Sending‚Ä¶",
        success_title: "Thanks! üíå",
        success_body: "Your message was sent successfully. I‚Äôll review it soon.",
        another: "Submit another",
        email_required_msg: "Email is required for business or newsletter."
      },
      fr: {
        title: "Contact ‚Äî Matcha √† Paris",
        nav_about: "√Ä propos",
        nav_spots: "Adresses",
        nav_contact: "Contact",
        toggle_next: "EN",
        tagline: "Vous connaissez une adresse, avez trouv√© un bug, ou souhaitez collaborer ? Dites-moi tout ‚òïÔ∏è",
        topic: "Sujet",
        spot: "Proposer une adresse",
        bug: "Bug / am√©lioration",
        collab: "Collaboration (pro)",
        email_label: "Email",
        email_hint: "(facultatif ‚Äî requis pour collaboration ou newsletter)",
        email_ph: "vous@exemple.com",
        place: "Nom du lieu",
        address: "Adresse",
        gmap: "Lien Google Maps",
        gmap_hint: "(facultatif)",
        message: "Message / d√©tails",
        message_ph: "Dites-moi ce qui sera utile aux lecteurs‚Ä¶",
        optin: "S‚Äôabonner aussi √† mon astuce hebdo",
        send: "Envoyer",
        sending: "Envoi‚Ä¶",
        success_title: "Merci ! üíå",
        success_body: "Votre message a bien √©t√© envoy√©. Je le lirai tr√®s vite.",
        another: "Envoyer un autre",
        email_required_msg: "L‚Äôemail est requis pour les collaborations ou la newsletter."
      }
    };

    let lang = localStorage.getItem('lang') || (navigator.language?.startsWith('fr') ? 'fr' : 'en');
    function t(key){ return I18N_SUGGEST[lang][key]; }

    function applyLangSuggest(){
      document.documentElement.lang = lang;
      document.title = t('title');

      // Navbar + toggle
      document.getElementById('navAbout').textContent = t('nav_about');
      document.getElementById('navSpots').textContent = t('nav_spots');
      document.getElementById('navContact').textContent = t('nav_contact');
      document.getElementById('langToggle').textContent = t('toggle_next');

      // Tagline
      document.getElementById('tagline').textContent = t('tagline');

      // Topic & segmented labels
      document.getElementById('topicTitle').textContent = t('topic');
      document.getElementById('lblSpot').textContent = t('spot');
      document.getElementById('lblBug').textContent = t('bug');
      document.getElementById('lblCollab').textContent = t('collab');

      // Email
      document.getElementById('lblEmail').firstChild.nodeValue = t('email_label') + ' ';
      document.getElementById('emailHint').textContent = t('email_hint');
      document.getElementById('emailField').placeholder = t('email_ph');

      // Spot fields
      document.getElementById('lblPlace').textContent = t('place');
      document.getElementById('lblAddress').textContent = t('address');
      document.getElementById('lblGmap').firstChild.nodeValue = t('gmap') + ' ';
      document.getElementById('gmapHint').textContent = t('gmap_hint');

      // Message
      document.getElementById('lblMessage').textContent = t('message');
      document.getElementById('messageBox').placeholder = t('message_ph');

      // Opt-in
      document.getElementById('lblOptin').lastChild.nodeValue = ' ' + t('optin');

      // Buttons / success
      document.getElementById('sendBtn').textContent = t('send');
      document.getElementById('successTitle').textContent = t('success_title');
      document.getElementById('successBody').textContent = t('success_body');
      document.getElementById('anotherBtn').textContent = t('another');
    }

    document.getElementById('langToggle').addEventListener('click', () => {
      lang = (lang === 'en') ? 'fr' : 'en';
      localStorage.setItem('lang', lang);
      applyLangSuggest();
    });

    // Elements for logic
    const form = document.getElementById('contactForm');
    const formCard = document.getElementById('formCard');
    const successCard = document.getElementById('successCard');
    const anotherBtn = document.getElementById('anotherBtn');
    const emailField = document.getElementById('emailField');
    const newsletterOptin = document.getElementById('newsletterOptin');
    const topicRadios = Array.from(document.querySelectorAll('input[name="topic"]'));
    const labels = Array.from(document.querySelectorAll('.seg-group label'));
    const spotFields = document.getElementById('spotFields');
    const placeName = document.getElementById('placeName');
    const placeAddress = document.getElementById('placeAddress');
    const sendBtn = document.getElementById('sendBtn');

    function currentTopic(){
      const r = topicRadios.find(r => r.checked);
      return r ? r.value : 'submit-spot';
    }

    function updateTopicUI(){
      // visual active state
      labels.forEach(l => l.classList.toggle('active', document.getElementById(l.getAttribute('for')).checked));

      // spot section
      const isSpot = currentTopic() === 'submit-spot';
      spotFields.style.display = isSpot ? 'block' : 'none';
      placeName.required = isSpot;
      placeAddress.required = isSpot;

      // email required only for business OR newsletter opt-in
      const needEmail = currentTopic() === 'collab' || newsletterOptin.checked;
      emailField.required = needEmail;
    }

    topicRadios.forEach(r => r.addEventListener('change', updateTopicUI));
    newsletterOptin.addEventListener('change', updateTopicUI);

    // Intercept submit and post with fetch to stay on-page
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // simple client validation for email rule
      if ((currentTopic() === 'collab' || newsletterOptin.checked) && !emailField.value) {
        alert(I18N_SUGGEST[lang].email_required_msg);
        emailField.focus();
        emailField.reportValidity?.();
        return;
      }

      sendBtn.disabled = true;
      const original = sendBtn.textContent;
      sendBtn.textContent = I18N_SUGGEST[lang].sending;

      try{
        const data = new FormData(form);
        const resp = await fetch(form.action, {
          method:'POST',
          body: data,
          headers: { 'Accept': 'application/json' }
        });

        if (resp.ok) {
          form.reset();
          updateTopicUI();
          formCard.style.display = 'none';
          successCard.style.display = 'block';
        } else {
          const err = await resp.json().catch(()=>({}));
          alert('Sorry, something went wrong. Please try again.\n' + (err?.error || ''));
        }
      }catch(err){
        alert('Network error. Please try again.');
      }finally{
        sendBtn.disabled = false;
        sendBtn.textContent = original;
      }
    });

    anotherBtn.addEventListener('click', () => {
      successCard.style.display = 'none';
      formCard.style.display = 'block';
      // default topic back to Submit a spot
      document.getElementById('t-spot').checked = true;
      updateTopicUI();
    });

    // Initial paint
    applyLangSuggest();
    updateTopicUI();
  </script>
</body>
</html>
