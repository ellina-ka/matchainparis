<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Contact ‚Äî Matcha in Paris</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Page-only tweaks */
    .center{ text-align:center; }
    .card-xl{ padding:22px; }
    .hint{ color: var(--muted); font-size: 12px; }
    /* Green primary button */
    #sendBtn.btn{ background:#2f5d3a; color:#fff; border-color:#2f5d3a; }
    #sendBtn.btn[disabled]{ opacity:.75; cursor:progress; }
    /* Success card */
    .success-card{
      background:#ffffff;
      border:1px solid var(--border);
      border-radius:12px;
      padding:22px;
      text-align:center;
      box-shadow:0 1px 0 rgba(0,0,0,.04);
    }
    .success-card h3{ margin:0 0 6px; }
    .seg-group{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 6px; }
    .seg-group input{ display:none; }
    .seg-group label{
      padding:8px 12px; border:1px solid var(--border); border-radius:999px;
      cursor:pointer; user-select:none; background:#fff;
    }
    .seg-group label.active{ border-color:#2f5d3a; color:#2f5d3a; background:#eef5ef; }
    /* Inputs */
    .form-input, .form-textarea{
      width:100%; padding:10px; border:1px solid var(--border); border-radius:10px;
      background:#fff;
    }
  </style>
</head>
<body>
  <header class="header-bar">
    <nav class="navbar">
      <a href="index.html">About</a>
      <a href="spots.html">Spots</a>
      <a class="active" href="suggest.html">Contact</a>
    </nav>
  </header>

  <!-- Handwritten logo -->
  <div class="logo-hero">
    <img src="assets/logo.png" alt="Matcha in Paris" class="site-logo">
  </div>

  <div class="container">
    <p class="text-muted center">Know a spot, found a bug, or want to collaborate? Tell me below ‚òïÔ∏è</p>

    <!-- Success state (hidden by default) -->
    <div id="successCard" class="success-card" style="display:none">
      <h3>Thanks! üíå</h3>
      <p>Your message was sent successfully. I‚Äôll review it soon.</p>
      <button id="anotherBtn" class="btn">Submit another</button>
    </div>

    <div id="formCard" class="card card-xl">
      <!-- We‚Äôll submit via fetch to avoid leaving your site -->
      <form id="contactForm" action="https://formspree.io/f/mpwlgdyb" method="POST" novalidate>
        <!-- Topic first -->
        <div>
          <strong>Topic</strong>
          <div class="seg-group" role="radiogroup" aria-label="Topic">
            <input id="t-spot" type="radio" name="topic" value="submit-spot" checked>
            <label for="t-spot">Submit a spot</label>

            <input id="t-bug" type="radio" name="topic" value="bug">
            <label for="t-bug">Bug / improvement</label>

            <input id="t-collab" type="radio" name="topic" value="collab">
            <label for="t-collab">Business collaboration</label>
          </div>
        </div>

        <!-- Email (optional unless business/newsletter) -->
        <label style="display:block;margin-top:10px">Email
          <span class="hint">(optional ‚Äî required for business or newsletter)</span>
          <input class="form-input" type="email" name="from_email" id="emailField" placeholder="you@example.com">
        </label>

        <!-- Spot-only fields -->
        <div id="spotFields" style="margin-top:12px">
          <div style="display:flex;gap:12px;flex-wrap:wrap">
            <label style="flex:1 1 260px">Place name
              <input class="form-input" name="place_name" id="placeName">
            </label>
            <label style="flex:2 1 320px">Address
              <input class="form-input" name="place_address" id="placeAddress">
            </label>
          </div>
          <label style="display:block;margin-top:8px">Google Maps link  <span class="hint">(optional)</span>
            <input class="form-input" name="gmap_url" placeholder="https://maps.google.com/‚Ä¶">
          </label>
        </div>

        <!-- Message -->
        <label style="display:block;margin-top:12px">Message / details
          <textarea class="form-textarea" name="message" rows="6" placeholder="Tell me what‚Äôs useful for readers‚Ä¶"></textarea>
        </label>

        <!-- Newsletter opt-in -->
        <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
          <label style="display:flex;align-items:center;gap:6px;font-size:14px;">
            <input type="checkbox" id="newsletterOptin" name="newsletter_optin" value="yes">
            Also subscribe to my weekly tip
          </label>
        </div>

        <!-- Submit -->
        <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
          <button id="sendBtn" class="btn" type="submit">Send</button>
        </div>

        <!-- Formspree metadata -->
        <input type="hidden" name="_subject" value="New message from matchainparis.com">
        <input type="text" name="_gotcha" style="display:none"> <!-- spam honeypot -->
      </form>
    </div>
  </div>

  <footer>¬© <span id="year"></span> matchainparis.com ‚Ä¢ Built with ‚ù§Ô∏è in Paris, by Ellina K-A</footer>

  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Elements
    const form = document.getElementById('contactForm');
    const formCard = document.getElementById('formCard');
    const successCard = document.getElementById('successCard');
    const anotherBtn = document.getElementById('anotherBtn');
    const emailField = document.getElementById('emailField');
    const newsletterOptin = document.getElementById('newsletterOptin');
    const topicRadios = Array.from(document.querySelectorAll('input[name="topic"]'));
    const labels = Array.from(document.querySelectorAll('.seg-group label'));
    const spotFields = document.getElementById('spotFields');
    const placeName = document.getElementById('placeName');
    const placeAddress = document.getElementById('placeAddress');
    const sendBtn = document.getElementById('sendBtn');

    function currentTopic(){
      const r = topicRadios.find(r => r.checked);
      return r ? r.value : 'submit-spot';
    }

    function updateTopicUI(){
      // visual active state
      labels.forEach(l => l.classList.toggle('active', document.getElementById(l.getAttribute('for')).checked));

      // spot section
      const isSpot = currentTopic() === 'submit-spot';
      spotFields.style.display = isSpot ? 'block' : 'none';
      placeName.required = isSpot;
      placeAddress.required = isSpot;

      // email required only for business OR newsletter opt-in
      const needEmail = currentTopic() === 'collab' || newsletterOptin.checked;
      emailField.required = needEmail;
    }

    topicRadios.forEach(r => r.addEventListener('change', updateTopicUI));
    newsletterOptin.addEventListener('change', updateTopicUI);
    updateTopicUI(); // initial

    // Intercept submit and post with fetch to stay on-page
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // simple client validation for email rule
      if ((currentTopic() === 'collab' || newsletterOptin.checked) && !emailField.value) {
        emailField.focus();
        emailField.reportValidity?.();
        return;
      }

      sendBtn.disabled = true;
      const original = sendBtn.textContent;
      sendBtn.textContent = 'Sending‚Ä¶';

      try{
        const data = new FormData(form);
        const resp = await fetch(form.action, {
          method:'POST',
          body: data,
          headers: { 'Accept': 'application/json' }
        });

        if (resp.ok) {
          form.reset();
          updateTopicUI();
          formCard.style.display = 'none';
          successCard.style.display = 'block';
        } else {
          // best-effort parse error
          const err = await resp.json().catch(()=>({}));
          alert('Sorry, something went wrong. Please try again.\n' + (err?.error || ''));
        }
      }catch(err){
        alert('Network error. Please try again.');
      }finally{
        sendBtn.disabled = false;
        sendBtn.textContent = original;
      }
    });

    anotherBtn.addEventListener('click', () => {
      successCard.style.display = 'none';
      formCard.style.display = 'block';
      // default topic back to Submit a spot
      document.getElementById('t-spot').checked = true;
      updateTopicUI();
    });
  </script>
</body>
</html>
